<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sopore Mandi Digital Khata | Professional Fruit Trading System</title>

  <!-- keep original stylesheet (so you can keep your big CSS) -->
  <link rel="stylesheet" href="style.css">

  <!-- small icon -->
  <link rel="icon" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">ğŸ</text></svg>'>

  <!-- Chart.js is used by your script.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>

  <!-- Accessibility: skip to main content -->
  <style>
    .skip-link {
      position: absolute;
      left: -999px;
      top: auto;
      width: 1px;
      height: 1px;
      overflow: hidden;
    }
    .skip-link:focus {
      left: 1rem;
      top: 1rem;
      width: auto;
      height: auto;
      padding: .5rem 1rem;
      background: #0d9488;
      color: #fff;
      border-radius: 6px;
      z-index: 9999;
    }
  </style>

  <!-- ENHANCED OVERRIDES:
       These styles intentionally override parts of your original style.css 
       to improve color grading, spacing, hover effects and readability,
       while keeping element IDs/classes unchanged so JS keeps working.
  -->
  <style>
    /* ---------- CSS variables (refined colors) ---------- */
    :root{
      --brand-1: #0d9488;    /* deep teal */
      --brand-2: #16a34a;    /* fresh green */
      --accent: #f59e0b;     /* warm gold accent */
      --bg: #ffffff;         /* main page background (light by default) */
      --panel: #ffffff;      /* cards/panels */
      --muted: #6b7280;
      --text: #0f172a;
      --glass: rgba(255,255,255,0.6);
      --shadow-1: 0 6px 20px rgba(16,24,40,0.06);
      --shadow-2: 0 14px 30px rgba(10, 10, 10, 0.06);
      --radius-lg: 14px;
      --radius-md: 10px;
      --transition-fast: 180ms cubic-bezier(.2,.8,.2,1);
    }

    /* keep layout sizes similar but tighten spacing for better scroll behavior */
    header {
      padding: 1.25rem 1.5rem;
      border-bottom: 1px solid rgba(15,23,42,0.06);
      background: linear-gradient(90deg, var(--brand-1), #0ea5a4);
      box-shadow: var(--shadow-2);
      position: sticky;
      top: 0;
      z-index: 120;
    }

    header .header-content h1 {
      font-size: 1.35rem;
      margin-bottom: 0.125rem;
    }
    header .subtitle { font-size: 0.88rem; opacity: 0.93; }

    /* Navigation pill style (compact) */
    nav {
      margin-top: 0.85rem;
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      align-items: center;
    }

    nav button {
      padding: 0.55rem 0.9rem;
      border-radius: 999px;
      background: rgba(255,255,255,0.12);
      border: 1px solid rgba(255,255,255,0.08);
      color: rgba(255,255,255,0.98);
      font-weight: 700;
      letter-spacing: -0.2px;
      transition: transform var(--transition-fast), background var(--transition-fast), box-shadow var(--transition-fast);
      box-shadow: none;
      font-size: 0.86rem;
    }
    nav button:hover { transform: translateY(-3px); background: rgba(255,255,255,0.18); box-shadow: var(--shadow-1); }
    nav button.active { background: #ffffff; color: var(--brand-2); transform: none; box-shadow: var(--shadow-2); border-color: rgba(0,0,0,0.04); }

    /* main container tighten */
    main {
      padding: 1.5rem;
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
    }

    /* make dashboard cards slightly denser */
    .kpi-card { padding: 1.25rem; border-radius: var(--radius-md); }
    .kpi-value { font-size: 1.6rem; }

    /* Stock cards: smaller height, stronger contrast for numbers */
    .stock-card { padding: 1rem; border-radius: 12px; }
    .stock-card .stock-value { font-size: 1.5rem; color: var(--text); }

    /* Charts container tweak: smaller padding on small screens */
    .chart-container { padding: 1rem; border-radius: 12px; }

    /* Tables: improve row density and hover */
    .transactions-table td, .transactions-table th { padding: 0.7rem 0.85rem; }
    .transactions-table tr:hover { background: rgba(16,24,40,0.02); transform: translateX(0); }
    .transactions-table th { font-size: 0.78rem; letter-spacing: 0.6px; }

    /* Back buttons: make them clearly visible and sticky at top of account view */
    .btn-back {
      background: transparent;
      color: var(--brand-1);
      border: 1px solid rgba(13,148,136,0.12);
      box-shadow: none;
      padding: 0.45rem 0.85rem;
      font-weight: 700;
      border-radius: 10px;
    }
    .btn-back:hover { background: rgba(13,148,136,0.06); transform: translateX(-4px); }

    /* Variety list: better contrast and spacing for delete */
    .varieties-list li { padding: 0.75rem; display:flex; align-items:center; justify-content:space-between; gap: 1rem; }
    .varieties-list li span { color: var(--text); font-weight: 600; }
    .varieties-list li button.btn-delete { background: transparent; border: 1px solid rgba(239,68,68,0.08); color: #b91c1c; padding: 0.45rem 0.6rem; border-radius: 8px; }
    .varieties-list li button.btn-delete:hover { background: rgba(239,68,68,0.06); transform: translateY(-2px); }

    /* Preference controls (dark mode toggle) */
    .toggle { align-items: center; gap: 1rem; }
    .toggle span { font-weight: 700; color: var(--text); }

    /* Floating Action Button: made slightly smaller and easier to tap */
    .fab { width:56px; height:56px; right:1.25rem; bottom:1.25rem; border: 3px solid white; }

    /* Modal: make backdrop dimmer and modal content narrower on big screens */
    .modal { background: rgba(6,7,7,0.55); }
    .modal-content { max-width: 820px; border-radius: 16px; padding: 1.5rem; }

    /* Bill preview content: ensure good contrast for print preview inside modal */
    #billPreviewContent { background: #fff; padding: 1rem; border-radius: 10px; box-shadow: var(--shadow-1); color: var(--text); }

    /* Khata items: improved hover */
    .khata-item:hover { transform: translateX(6px); box-shadow: var(--shadow-2); }

    /* small screens: ensure large hit targets for buttons */
    @media (max-width:720px){
      nav { gap: 0.45rem; }
      nav button { padding: 0.5rem 0.72rem; font-size: 0.82rem; }
      .account-card { padding: 1rem; }
    }

    /* subtle animations & focus states for accessibility */
    button, input, select, textarea { transition: box-shadow var(--transition-fast), transform var(--transition-fast), border-color var(--transition-fast); }
    button:focus, input:focus, select:focus, textarea:focus { outline: 3px solid rgba(16,148,136,0.12); outline-offset: 2px; }

    /* Improve visibility of small text items like "â† Back to Growers" if your original CSS hid them */
    .btn-back { font-size: 0.95rem; }

    /* ensure variety default-rate text is clearly readable */
    .varieties-list li span::after { content: ""; display:block; }
  </style>
</head>
<body>
  <a href="#main" class="skip-link">Skip to content</a>

  <header>
    <div class="header-content" style="display:flex; align-items:center; justify-content:space-between; gap:1rem;">
      <div style="display:flex; align-items:center; gap:1rem;">
        <div style="font-size:1.55rem; line-height:1; filter: drop-shadow(0 2px 6px rgba(0,0,0,0.06));">ğŸ</div>
        <div>
          <h1 style="margin:0;">Sopore Mandi Digital Khata</h1>
          <div class="subtitle">Professional Fruit Trading Management System</div>
        </div>
      </div>

      <div style="display:flex; align-items:center; gap:0.75rem;">
        <!-- quick status (non-functional, purely UI) -->
        <div aria-hidden="true" style="font-size:0.9rem; color:rgba(255,255,255,0.95); font-weight:600;">Offline â€¢ Secure</div>
        <!-- preferences shortcut (JS uses the checkbox with id `darkModeToggle`) -->
        <label style="display:flex; align-items:center; gap:0.5rem; background:rgba(255,255,255,0.12); padding:0.45rem 0.6rem;border-radius:999px;">
          <input id="darkModeToggle" type="checkbox" style="width:18px;height:18px;" aria-label="Toggle dark mode">
          <span style="color:white; font-weight:700; font-size:0.85rem;">Dark</span>
        </label>
      </div>
    </div>

    <nav aria-label="Primary navigation">
      <button id="dashboardTab" class="active">ğŸ“Š Dashboard</button>
      <button id="growersTab">ğŸŒ¾ Growers</button>
      <button id="customersTab">ğŸ‘¥ Customers</button>
      <button id="expensesTab">ğŸ’° Expenses</button>
      <button id="khataTab">ğŸ“‹ Khata</button>
      <button id="settingsTab">âš™ï¸ Settings</button>
    </nav>
  </header>

  <main id="main">
    <!-- (Full markup is intentionally identical to your original structure
         so JS functions keep working â€” only some spacing/aria attributes added) -->

    <!-- Dashboard Section -->
    <section id="dashboardSection" class="tab active">
      <div class="dashboard-header">
        <h2>Business Overview</h2>
        <div class="date-filter">
          <label for="dateRange" style="font-weight:700; color:var(--muted)">Period:</label>
          <select id="dateRange" aria-label="Select date range">
            <option value="today">Today</option>
            <option value="week">This Week</option>
            <option value="month">This Month</option>
            <option value="all" selected>All Time</option>
          </select>
        </div>
      </div>

      <!-- KPI Cards -->
      <div class="kpi-grid">
        <div class="kpi-card">
          <div class="kpi-icon">ğŸ“¦</div>
          <div class="kpi-title">Total Boxes Bought</div>
          <div class="kpi-value" id="kpiBoxesBought">0</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-icon">ğŸ“¤</div>
          <div class="kpi-title">Total Boxes Sold</div>
          <div class="kpi-value" id="kpiBoxesSold">0</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-icon">ğŸ’°</div>
          <div class="kpi-title">Total Purchases</div>
          <div class="kpi-value" id="kpiAmountBought">â‚¹0</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-icon">ğŸ’µ</div>
          <div class="kpi-title">Total Sales</div>
          <div class="kpi-value" id="kpiAmountSold">â‚¹0</div>
        </div>
        <div class="kpi-card profit">
          <div class="kpi-icon">ğŸ“ˆ</div>
          <div class="kpi-title">Net Profit/Loss</div>
          <div class="kpi-value" id="kpiProfit">â‚¹0</div>
          <div class="kpi-sub" id="kpiGross">Gross: â‚¹0</div>
        </div>
      </div>

      <!-- Stock by Variety -->
      <div class="dashboard-section">
        <h3>ğŸ“¦ Current Stock by Variety</h3>
        <div class="stock-grid" id="stockGrid"></div>
      </div>

      <!-- Charts -->
      <div class="dashboard-section">
        <h3>ğŸ“Š Analytics & Trends</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 1rem;">
          <div class="chart-container">
            <h4 style="margin-bottom:1rem; color:var(--brand-1); font-weight:700">7-Day Profit Trend</h4>
            <canvas id="profitChart" height="200"></canvas>
          </div>
          <div class="chart-container">
            <h4 style="margin-bottom:1rem; color:var(--brand-1); font-weight:700">Stock Distribution</h4>
            <canvas id="stockPieChart" height="200"></canvas>
          </div>
        </div>
      </div>

      <!-- Today's Summary -->
      <div class="dashboard-section">
        <h3>ğŸ“… Today's Activity</h3>
        <div class="today-summary">
          <div class="today-card">
            <div class="today-label">Boxes Bought Today</div>
            <div class="today-value" id="todayBought">0</div>
          </div>
          <div class="today-card">
            <div class="today-label">Boxes Sold Today</div>
            <div class="today-value" id="todaySold">0</div>
          </div>
          <div class="today-card">
            <div class="today-label">Today's Profit</div>
            <div class="today-value" id="todayProfit">â‚¹0</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Growers Section -->
    <section id="growersSection" class="tab">
      <div class="section-header">
        <h2>ğŸŒ¾ Grower Accounts</h2>
        <div class="section-tools">
          <input type="text" id="growerSearch" placeholder="Search growers..." aria-label="Search growers">
          <button class="btn-primary" id="addGrowerBtn">+ Add New Grower</button>
        </div>
      </div>

      <div id="growersList" class="accounts-grid"></div>

      <!-- Grower Account View -->
      <div id="growerAccountView" class="account-view hidden" aria-hidden="true">
        <div class="account-header">
          <button class="btn-back" id="backFromGrower">â† Back to Growers</button>
          <div>
            <h2 id="growerAccountName"></h2>
            <div class="account-summary" id="growerAccountSummary"></div>
          </div>
        </div>

        <div class="account-actions">
          <button class="btn-primary" id="addTransactionGrower">+ Add Purchase Transaction</button>
          <button class="btn-secondary" id="generateBillGrower">ğŸ“„ Generate Bill</button>
        </div>

        <form id="growerTransactionForm" class="transaction-form hidden" aria-hidden="true">
          <h3>Add Purchase Transaction</h3>
          <div class="form-grid">
            <input type="date" id="growerTxDate" required>
            <select id="growerTxVariety" required><option value="">Select Variety</option></select>
            <input type="number" id="growerTxBoxes" placeholder="No. of Boxes" min="1" required>
            <input type="number" id="growerTxRate" placeholder="Rate per Box (â‚¹)" min="0" step="0.01" required>
            <input type="number" id="growerTxCommission" placeholder="Commission (â‚¹)" min="0" step="0.01">
            <input type="number" id="growerTxTransport" placeholder="Transport (â‚¹)" min="0" step="0.01">
            <select id="growerTxPaymentStatus"><option value="paid">Paid</option><option value="due" selected>Due</option></select>
            <textarea id="growerTxNotes" placeholder="Notes (optional)" rows="2"></textarea>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn-primary">Save Transaction</button>
            <button type="button" class="btn-secondary" id="cancelGrowerTx">Cancel</button>
          </div>
        </form>

        <div class="transactions-container">
          <h3>Transaction History</h3>
          <table id="growerTransactionsTable" class="transactions-table">
            <thead><tr><th>Date</th><th>Variety</th><th>Boxes</th><th>Rate</th><th>Commission</th><th>Transport</th><th>Total</th><th>Status</th><th>Actions</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Customers Section -->
    <section id="customersSection" class="tab">
      <div class="section-header">
        <h2>ğŸ‘¥ Customer Accounts</h2>
        <div class="section-tools">
          <input type="text" id="customerSearch" placeholder="Search customers..." aria-label="Search customers">
          <button class="btn-primary" id="addCustomerBtn">+ Add New Customer</button>
        </div>
      </div>

      <div id="customersList" class="accounts-grid"></div>

      <div id="customerAccountView" class="account-view hidden" aria-hidden="true">
        <div class="account-header">
          <button class="btn-back" id="backFromCustomer">â† Back to Customers</button>
          <div>
            <h2 id="customerAccountName"></h2>
            <div class="account-summary" id="customerAccountSummary"></div>
          </div>
        </div>

        <div class="account-actions">
          <button class="btn-primary" id="addTransactionCustomer">+ Add Sale Transaction</button>
          <button class="btn-secondary" id="generateBillCustomer">ğŸ“„ Generate Bill</button>
        </div>

        <form id="customerTransactionForm" class="transaction-form hidden" aria-hidden="true">
          <h3>Add Sale Transaction</h3>
          <div class="form-grid">
            <input type="date" id="customerTxDate" required>
            <select id="customerTxVariety" required><option value="">Select Variety</option></select>
            <input type="number" id="customerTxBoxes" placeholder="No. of Boxes" min="1" required>
            <input type="number" id="customerTxRate" placeholder="Rate per Box (â‚¹)" min="0" step="0.01" required>
            <input type="number" id="customerTxCommission" placeholder="Commission (â‚¹)" min="0" step="0.01">
            <input type="number" id="customerTxTransport" placeholder="Transport (â‚¹)" min="0" step="0.01">
            <select id="customerTxPaymentStatus"><option value="received" selected>Payment Received</option><option value="pending">Pending</option></select>
            <textarea id="customerTxNotes" placeholder="Notes (optional)" rows="2"></textarea>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn-primary">Save Transaction</button>
            <button type="button" class="btn-secondary" id="cancelCustomerTx">Cancel</button>
          </div>
        </form>

        <div class="transactions-container">
          <h3>Transaction History</h3>
          <table id="customerTransactionsTable" class="transactions-table">
            <thead><tr><th>Date</th><th>Variety</th><th>Boxes</th><th>Rate</th><th>Commission</th><th>Transport</th><th>Total</th><th>Status</th><th>Actions</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Khata Section -->
    <section id="khataSection" class="tab">
      <div class="section-header">
        <h2>ğŸ“‹ Khata - Pending Payments</h2>
        <div class="section-tools">
          <input type="text" id="khataSearch" placeholder="Search name..." aria-label="Search khata">
          <button class="btn-secondary" id="markAllPaidGrowers">Mark All Growers Paid</button>
          <button class="btn-secondary" id="markAllReceivedCustomers">Mark All Customers Received</button>
        </div>
      </div>
      <div class="khata-summary" id="khataSummary"></div>
      <div class="khata-grid">
        <div class="khata-panel">
          <h3>ğŸ’° Due to Growers</h3>
          <div id="growersKhataList" class="khata-list"></div>
        </div>
        <div class="khata-panel">
          <h3>ğŸ’µ Due from Customers</h3>
          <div id="customersKhataList" class="khata-list"></div>
        </div>
      </div>
    </section>

    <!-- Settings Section -->
    <section id="settingsSection" class="tab">
      <h2>âš™ï¸ Settings</h2>
      <div class="settings-grid">
        <div class="settings-card">
          <h3>ğŸ‘¤ My Profile</h3>
          <form id="profileForm">
            <input type="text" id="buyerName" placeholder="Your Name / Firm" required>
            <input type="text" id="buyerMandi" placeholder="Mandi Name">
            <input type="text" id="buyerPhone" placeholder="Phone">
            <input type="text" id="buyerGst" placeholder="GST No.">
            <input type="text" id="buyerAddress" placeholder="Address">
            <button type="submit" class="btn-primary">Save Profile</button>
          </form>
        </div>

        <div class="settings-card">
          <h3>ğŸ Apple Varieties</h3>
          <form id="varietyForm">
            <input type="text" id="newVariety" placeholder="Variety Name" required>
            <input type="number" id="defaultRate" placeholder="Default Rate (â‚¹)" min="0" step="0.01">
            <button type="submit" class="btn-primary">Add Variety</button>
          </form>
          <ul id="varietiesList" class="varieties-list"></ul>
        </div>

        <div class="settings-card">
          <h3>Preferences</h3>
          <label class="toggle" style="display:flex; align-items:center;">
            <input type="checkbox" id="darkModeToggle" aria-label="Enable dark mode">
            <span>Enable Dark Mode</span>
          </label>
          <div style="display:flex; gap:0.5rem; flex-wrap:wrap;">
            <button class="btn-secondary" id="exportDataBtn">ğŸ“¥ Export All Data (JSON)</button>
            <label class="btn-secondary" style="cursor:pointer; display:inline-flex; align-items:center; gap:0.5rem;">
              ğŸ“¤ Import Data (JSON)
              <input type="file" id="importDataBtn" accept="application/json" hidden>
            </label>
          </div>
        </div>
      </div>
    </section>

    <!-- Expenses Section -->
    <section id="expensesSection" class="tab">
      <div class="section-header">
        <h2>ğŸ’° Expenses & Commission</h2>
        <button class="btn-primary" id="addExpenseBtn">+ Add Expense</button>
      </div>
      <form id="expenseForm" class="transaction-form hidden">
        <div class="form-grid">
          <input type="date" id="expenseDate" required>
          <input type="text" id="expenseDesc" placeholder="Description" required>
          <input type="number" id="expenseAmount" placeholder="Amount (â‚¹)" min="0" step="0.01" required>
          <select id="expenseCategory">
            <option value="Transport">Transport</option>
            <option value="Loading">Loading</option>
            <option value="Labour">Labour</option>
            <option value="Packaging">Packaging</option>
            <option value="Rent">Rent</option>
            <option value="Other">Other</option>
          </select>
        </div>
        <div class="form-actions">
          <button type="submit" class="btn-primary">Save Expense</button>
          <button type="button" class="btn-secondary" id="cancelExpenseBtn">Cancel</button>
        </div>
      </form>
      <div class="transactions-container">
        <h3>Expense History</h3>
        <table id="expensesTable" class="transactions-table">
          <thead><tr><th>Date</th><th>Description</th><th>Category</th><th class="num">Amount</th><th>Actions</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </main>

  <footer>
    <p style="margin:0;">Sopore Mandi Digital Khata â€” Professional Fruit Trading System | Offline & Secure</p>
  </footer>

  <!-- Modal for Add Grower/Customer -->
  <div id="addAccountModal" class="modal hidden" aria-hidden="true">
    <div class="modal-content">
      <span class="modal-close" role="button" aria-label="Close modal">&times;</span>
      <h3 id="modalTitle">Add New Account</h3>
      <form id="addAccountForm">
        <input type="text" id="accountNameInput" placeholder="Name" required>
        <input type="text" id="accountContactInput" placeholder="Contact Number (optional)">
        <input type="text" id="accountAddressInput" placeholder="Address (optional)">
        <div style="display:flex; gap:0.5rem;">
          <button type="submit" class="btn-primary">Create Account</button>
          <button type="button" class="btn-secondary modal-close-btn">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Floating Action Button -->
  <button class="fab" id="fabButton" title="Quick Actions">+</button>

  <!-- Bill Preview Modal -->
  <div id="billPreviewModal" class="modal hidden" aria-hidden="true">
    <div class="modal-content" style="max-width: 900px;">
      <span class="modal-close" id="closeBillPreview" role="button" aria-label="Close bill preview">&times;</span>
      <h3>ğŸ“„ Bill Preview</h3>
      <div id="billPreviewContent" style="max-height: 70vh; overflow-y: auto; margin-top: 1rem;"></div>
      <div class="form-actions" style="margin-top: 1rem;">
        <button class="btn-primary" id="printBillBtn">ğŸ–¨ï¸ Print Bill</button>
        <button class="btn-secondary" id="markPrintedBtn">âœ“ Mark as Printed</button>
        <button class="btn-secondary modal-close-btn">Close</button>
      </div>
    </div>
  </div>

  <!-- keep your script file unchanged (contains all features/logic) -->
  <script src="script.js" defer></script>
</body>
</html>
